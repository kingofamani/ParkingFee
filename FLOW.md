# 程式流程圖

## 網頁載入與初始化流程

```mermaid
graph TD
    A["開始"] --> B{"取得使用者地理座標"};
    B -- "成功" --> C["呼叫 Nominatim API<br>進行反向地理編碼"];
    B -- "失敗/拒絕" --> D["使用預設值(例如：臺北市)"];
    C --> E{"解析 API 回應"};
    E -- "成功" --> F["取得縣市名稱"];
    F --> G["設定縣市下拉選單預設值"];
    E -- "失敗" --> D;
    G --> H["頁面載入完成"];
    D --> H;
```

## 使用者查詢流程

```mermaid
graph TD
    subgraph "單一縣市查詢"
        A["使用者選擇縣市、<br>輸入車號、選擇車種"] --> B["點擊「查詢」按鈕"];
        B --> C["前端 JS 發送請求到 Flask 後端<br>(/api/query)"];
        C --> D["Flask 後端依據縣市<br>呼叫對應的停車費 API"];
        D --> E{"API 回應"};
        E -- "成功 (5秒內)" --> F["後端將原始資料回傳給前端"];
        E -- "逾時/失敗" --> G["後端回傳錯誤訊息給前端"];
        F --> H["前端正規化資料格式<br>並動態生成結果卡片"];
        G --> H;
        H --> I["將查詢參數與結果<br>存入 Local Storage"];
    end

    subgraph "全國一鍵查詢"
        J["使用者點擊<br>「一鍵查詢全國」按鈕"] --> K["前端 JS 獲取所有縣市列表"];
        K --> L["為每個縣市並行(parallel)發送請求到<br>Flask 後端 (/api/query)"];
        L --> M["前端等待所有請求完成<br>(Promise.all)"];
        M --> N["前端收集所有個別的<br>成功/失敗/無資料狀態"];
        N --> O["前端正規化所有成功資料<br>並為所有狀態動態生成結果卡片"];
        O --> P["將查詢參數與彙總結果<br>存入 Local Storage"];
    end
``` 